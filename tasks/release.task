# release.task

# Initialization
# Generate release notes and a change log for a given tag range. Uses _TOFILE to
# capture console output into release_notes.txt while running.
SET $COMMIT = 0
SET $TAG = "none"
SET $TAG_OLD = "none"

# TASK script
RUN clear
PRINT "\nRetrieving tags...\n\n"
RUN git tag --sort=-v:refname
PRINT "\nEnter release tag: "
INPUT $TAG
PRINT "\nEnter baseline release tag ('none' if no baseline): "
INPUT $TAG_OLD
RUN cls
RUN _VERSION to $COMMIT
RUN _TOFILE -file release_notes.txt --start
PRINT "\n\n=============================== RELEASE NOTES ===============================\n"
PRINT "\n Git Repository: https://github.com/sensei-zenabi/BUDOSTACK.git\n"
PRINT "\n  Releance branch:         main"
PRINT "\n  Release tag:             " + $TAG
PRINT "\n  Release commit number:   " + $COMMIT
PRINT "\n  Baseline release:        " + $TAG_OLD
PRINT "\n"
RUN help
PRINT "\n\n"
PRINT "\n\n================================= CHANGE LOG ================================\n"
PRINT "\n"
IF ($TAG_OLD == none):
  RUN git --no-pager log --name-only
ELSE:
  RUN git --no-pager log --name-only $TAG_OLD..HEAD
END
RUN _TOFILE --stop

